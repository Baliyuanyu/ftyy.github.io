`; blob = new Blob([htmlContent], { type: 'text/html' }); fileName = 'document.html'; } else if (format === 'pdf') { // 简单的PDF导出，实际生产环境可能需要使用更专业的库 alert('PDF导出功能需要使用额外的库，这里仅提供演示。'); return; } const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = fileName; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); } // 更新字体大小 function updateFontSize() { const size = fontSlider.value + 'px'; editor.style.fontSize = size; preview.style.fontSize = size; localStorage.setItem('fontSize', fontSlider.value); } // 更新行高 function updateLineHeight() { const height = lineHeightSlider.value; editor.style.lineHeight = height; preview.style.lineHeight = height; localStorage.setItem('lineHeight', lineHeightSlider.value); } // 显示同步状态 function showSyncStatus(text, className) { syncStatus.innerHTML = `
${text}
`; } // 打开模态框 function openModal(action) { currentModalAction = action; if (action === 'link') { modalTitle.textContent = '添加链接'; modalInputText.placeholder = '显示的文本'; modalInputUrl.placeholder = 'https://example.com'; } else if (action === 'image') { modalTitle.textContent = '添加图片'; modalInputText.placeholder = '图片描述'; modalInputUrl.placeholder = 'https://example.com/image.jpg'; } // 获取选中文本 const selection = editor.getSelection(); if (selection.text) { modalInputText.value = selection.text; } else { modalInputText.value = ''; } modal.classList.remove('hidden'); setTimeout(() => { modalContent.classList.remove('scale-95', 'opacity-0'); modalContent.classList.add('scale-100', 'opacity-100'); }, 10); modalInputUrl.focus(); } // 关闭模态框 function closeModal() { modalContent.classList.remove('scale-100', 'opacity-100'); modalContent.classList.add('scale-95', 'opacity-0'); setTimeout(() => { modal.classList.add('hidden'); }, 300); } // 执行命令 function executeCommand(command, value) { const selection = editor.getSelection(); let text = selection.text; let result = ''; switch (command) { case 'heading': const level = parseInt(value); const prefix = '#'.repeat(level) + ' '; result = prefix + (text || '标题文本'); break; case 'bold': result = `**${text || '粗体文本'}**`; break; case 'italic': result = `*${text || '斜体文本'}*`; break; case 'strikethrough': result = `~~${text || '删除线文本'}~~`; break; case 'list': if (value === 'ul') { result = `- ${text || '无序列表项'}`; } else if (value === 'ol') { result = `1. ${text || '有序列表项'}`; } break; case 'task': result = `- [ ] ${text || '任务列表项'}`; break; case 'code': if (selection.isCollapsed) { result = '`代码`'; editor.setSelection(selection.start + 1, selection.start + 3); } else { result = `\`${text}\``; } break; case 'blockquote': result = `> ${text || '引用文本'}`; break; default: return; } // 插入文本 editor.replaceSelection(result); // 如果是列表，添加换行以便继续输入 if (command === 'list' || command === 'task' || command === 'blockquote') { editor.setSelection(selection.start + result.length, selection.start + result.length); editor.insertText('\n'); } // 更新预览 updatePreview(); } // 模态框确认 modalConfirm.addEventListener('click', () => { const text = modalInputText.value; const url = modalInputUrl.value; if (!url) { alert('URL不能为空'); return; } let result = ''; if (currentModalAction === 'link') { result = `[${text || '链接文本'}](${url})`; } else if (currentModalAction === 'image') { result = `![${text || '图片描述'}](${url})`; } // 插入文本 const selection = editor.getSelection(); editor.replaceSelection(result); // 更新预览 updatePreview(); // 关闭模态框 closeModal(); }); // 扩展TextAreaElement以支持获取和设置选区 Object.defineProperties(HTMLTextAreaElement.prototype, { getSelection: { value: function() { return { start: this.selectionStart, end: this.selectionEnd, text: this.value.substring(this.selectionStart, this.selectionEnd), isCollapsed: this.selectionStart === this.selectionEnd }; } }, replaceSelection: { value: function(text) { const start = this.selectionStart; const end = this.selectionEnd; this.value = this.value.substring(0, start) + text + this.value.substring(end); const pos = start + text.length; this.setSelectionRange(pos, pos); } }, insertText: { value: function(text) { const start = this.selectionStart; this.value = this.value.substring(0, start) + text + this.value.substring(start); const pos = start + text.length; this.setSelectionRange(pos, pos); } } }); // 初始化编辑器 init();
